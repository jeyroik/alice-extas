# alice-extas

Yandex.Alice Extas package
Работа с навыками Алисы Яндекса на базе extas'a.

Данная библиотека поддерживает сценарии (см. руководство ниже).

# Установка

`composer require jeyroik/alice-extas:*`

# Использование

## Реализация навыка

Реализуем плагин (см. детали jeyroik/extas-foundation) для стадии `alice.skill.run.<name скила>`

## Установка навыков

1. В extas.json в секцию `skills` добавляем данные своих скиллов.
- `name`: алиас скила, будет использоваться для управления его работой;
- `description`: описание скила, опциональное поле;
- `id`: идентификатор скилла (см. панель разработчика в диалогах).

2. См. инструкции в `jeyroik/extas-foundation` для базовой подготовки к использованию extas'a.
3. Устанавливаем extas: `/vendor/bin/extas i -p extas.json`

## Использование сценария

- Сценарий состоит из реакций.
- Реакция состоит из проверки условий и имени шага.
- Шаг состоит из имени и описания.

Шаги можно установить предварительно.

### Установка шагов

```json
{
    "steps": [
        {
          "name": "demo.help",
          "title": "Помощь",
          "description": "Пользователь запросил помощь"
        },
        {
          "name": "demo.start",
          "title": "Начало использования",
          "description": "На этом шаге приветствуем пользователя"
        }
      ]
}
```

Как видно, шаги не зависят от сценария и могут переиспользоваться.
По каждому шагу запускается следующие стадии (события):
- step.<name шага>
- <name сценария>.step.<name шага>
- <name навыка>.<name сценария>.step.<name шага>

Таким образом возможно реализовать как общую логику (и ограничения), так и персонально для каждого сценария и навыка.

### Установка сценария

```json
"scenarios": [
    {
      "name": "demo",
      "title": "Демонстрационный сценарий",
      "description": "Это демонстрационный сценарий",
      "skill_name": "test",
      "schema": {
        "message_1": [{
          "condition": "",
          "step": "demo.start"
        }],
        "message_x": [{
          "condition": "",
          "step": "demo.help"
        }]
      }
    }
  ]
```

Схема сценария может содержать следующие секции:

- `message_N`, где `N` - любое целое число, представляющее идентификатор сообщения (см. документацию по навыкам). Данная секция содержит реакции на конкретное по порядку сообщение.
- `message_x` - данная секция содержит реакции для вариативных по порядку сообщений.

Каждая реакция состоит из
- `condition` - проверка условия. Если данная реакция должна применяться всегда, поле оставляется пустым, в противном случае здесь указывается имя класса. Класс реакции должен реализовывать метод `__invoke(IAliceCall $call)` и возвращать `bool` (`true` или `false`). Если `true`, то будет запущен соответствующий реакции шаг.
- `step` - имя шага, который нужно запустить, если условия подходят.
